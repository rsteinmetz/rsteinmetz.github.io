<div id="inner">
    <div class="slideIntroText">
        How many different vehicle manufactueers created Electric Vehicles?
    </div>
    <div id="tooltip"></div>
    <div id="scene4"></div>
    <script>
        // initailize screen data
        var margin = {
            top: 30,
            right: 30,
            bottom: 70,
            left: 60
        }
        var width = 1600 - margin.left - margin.right
        var height = 900 - margin.top - margin.bottom 
        var tooltip = d3.select("#tooltip").attr("pointer-events", "none")
        var data = [];

        const svg = d3
            .select("#scene4")
            .append("svg")
            .attr("id", "graph")
            .attr("width", "100%")
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


        function updateChart() {

            formatDate = d3.utcFormat("%B %-d, %Y")
            formatValue = d3.format(".2f")
            parseDate = d3.utcParse("%Y-%m-%d")
            formatChange = function() {
                const f = d3.format("+.2%");
                return (y0, y1) => f((y1 - y0) / y0);
            }

            x = d3.scaleBand()
                .domain(d3.utcDay
                    .range(data[0].Date, +data[data.length - 1].Date + 1)
                    .filter(d => d.getUTCDay() !== 0 && d.getUTCDay() !== 6))
                .range([margin.left, width - margin.right])
                .padding(0.2)

            xAxis = g => g
                .attr("transform", `translate(0,${height - margin.bottom})`)
                .call(d3.axisBottom(x)
                    .tickValues(d3.utcMonday
                        .every(width > 720 ? 1 : 2)
                        .range(data[0].Date, data[data.length - 1].date))
                    .tickFormat(d3.utcFormat("%-m/%-d")))
                .call(g => g.select(".domain").remove())

            y = d3.scaleLog()
                .domain([d3.min(data, d => d.Low), d3.max(data, d => d.High)])
                .rangeRound([height - margin.bottom, margin.top])

            yAxis = g => g
                .attr("transform", `translate(${margin.left},0)`)
                .call(d3.axisLeft(y)
                    .tickFormat(d3.format("$~f"))
                    .tickValues(d3.scaleLinear().domain(y.domain()).ticks()))
                .call(g => g.selectAll(".tick line").clone()
                    .attr("stroke-opacity", 0.2)
                    .attr("x2", width - margin.left - margin.right))
                .call(g => g.select(".domain").remove())


            svg.append("g")
            .call(xAxis)

            svg.append("g")
            .call(yAxis)

            const g = svg.append("g")
                .attr("stroke-linecap", "round")
                .attr("stroke", "black")
                .selectAll("g")
                .data(data)
                .join("g")
                .attr("transform", d => `translate(${x(d.Date)},0)`);

            // g.append("line")
            // .attr("y1", d => y(d.low))
            // .attr("y2", d => y(d.high))

            // g.append("line")
            // .attr("y1", d => y(d.Open))
            // .attr("y2", d => y(d.Close))
            // .attr("stroke-width", x.bandwidth)
            // .attr("stroke", d => d.Open > d.Close ? d3.schemeSet1[0]
            // : d.close > d.open ? d3.schemeSet1[2]
            // : d3.schemeSet1[8])

            // g.append("title")
            //     .text(d => `${formatDate(d.Date)}
            // Open: ${formatValue(d.Open)}
            // Close: ${formatValue(d.Close)} (${formatChange(d.Open, d.Close)})
            // Low: ${formatValue(d.Low)}
            // High: ${formatValue(d.High)}`);
        }

        // grab dataset
        d3
            .csv("https://raw.githubusercontent.com/rsteinmetz/rsteinmetz.github.io/master/cs-498/data/tesla-stock.csv")
            .then((d) => {
                data = d
                console.log(d);
                updateChart(d)
            })
    </script>
</div>